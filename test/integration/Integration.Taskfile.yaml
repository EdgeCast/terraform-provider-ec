# https://taskfile.dev

version: '3'

silent: true

tasks:
  default:
    cmds:
      - defer: rm -rf resource.tf .terraform .terraform.lock.hcl terraform.tfstate terraform.tfstate.backup
      - defer: terraform apply -auto-approve -destroy {{.CREDS}} {{.ACCOUNT}}
      - rm -rf resource.tf .terraform .terraform.lock.hcl terraform.tfstate terraform.tfstate.backup
      - terraform init
      - cp create.tf.step resource.tf
      - terraform validate
      - terraform $MODE -auto-approve {{.CREDS}} {{.ACCOUNT}}
      - cp update.tf.step resource.tf
      - terraform validate
      - terraform $MODE -auto-approve {{.CREDS}} {{.ACCOUNT}}
      - terraform import -allow-missing-config {{.CREDS}} {{.ACCOUNT}} {{.RESOURCE_NAME}}.imported {{.IMPORT_ID}}